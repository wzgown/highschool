#名额分配到校 PDF 格式分析

## 已转换的文件

| 文件 | 状态 | 格式 | 问题 |
|------|--------|--------|------|
| 静安区 | ✅ 已转换 | 标准 | 需要匹配格式 |
| 松江区 | ✅ 已转换 | 标准 | 需要匹配格式 |
| 黄浦区 | ✅ 已转换 | OCR 问题严重 | 需要人工处理 |
| 闵行区 | ✅ 已转换 | **特殊格式** | 格式不同 |
| 嘉定区 | ✅ 已转换 | **两段式格式** | 需要专用解析器 |

## 闵行区文件格式分析

```
2025年上海市高中名额分配到区招生计划 （闵行区）

    根据《上海市教育委员会关于2025年本市高中阶段学校招生工作的若干意见 》（沪教委基〔2025〕5号）要求，现
对2025年上海市高中名额分配到区招生计划公示 。

序号

学校
招生代码

学校名称

委属名额
区属名额数
...

062001 062002 ...
上海市市西中学
上海市育才中学
...
```

**特点**：
- 使用 `序号` 列，而非简单的学校名称列表
- 有 `委属名额`（全市）和 `区属名额数`（各校分配给各区的总数）两列
- 结构更复杂，不是标准的「代码 | 名称 | 名额」格式

## 建议

闵行区的格式与其他区不同，需要**专门的解析脚本**。

可以考虑：
1. 人工处理闵行区数据（Excel格式可能更准确）
2. 使用 OCR 直接识别表格结构
3. 从官方网站获取数据

---

## 嘉定区文件格式分析

### PDF 原始格式 (推荐使用 pdfplumber)

嘉定区 PDF 使用多列表格布局，每行包含一所初中学校和 1-4 个高中名额分配：

```
表头行1: 初中学校 | 分配到初中学校的招生学校及计划数
表头行2:          | 招生学校代码 | 招生学校名称 | 计划数 | 招生学校代码 | ...

数据行示例:
上海市嘉定区启良中学 | 142001 | 上海市嘉定区第一中学 | 6 | 142002 | 上海交通大学附属中学嘉定分校 | 7 | 142004 | 上海师范大学附属中学嘉定新城分校 | 2
上海市嘉定区方泰中学 | 152003 | 华东师范大学第二附属中学 | 1 | 142001 | 上海市嘉定区第一中学 | 1 | 142002 | 上海交通大学附属中学嘉定分校 | 2 | 142004 | 上海师范大学附属中学嘉定新城分校 | 1
交大附中附属嘉定洪德中学 | 102056 | 上海交通大学附属中学 | 1 | 142001 | 上海市嘉定区第一中学 | 4 | 142002 | 上海交通大学附属中学嘉定分校 | 5 | 142004 | 上海师范大学附属中学嘉定新城分校 | 1
```

**表格结构**：
- 列1: 初中学校名称
- 列2-4: 高中代码1, 高中名称1, 计划数1（部分初中可能没有，如没有委属名额）
- 列5-7: 高中代码2, 高中名称2, 计划数2
- 列8-10: 高中代码3, 高中名称3, 计划数3
- 列11-13: 高中代码4, 高中名称4, 计划数4

**pdfplumber 提取脚本**: `scripts/extract_jiading_quota_v2.py`

### Markdown 转换格式 (不推荐)

MarkItDown 转换后的 markdown 格式混乱，数据重复严重：

```
2025年名额分配综合评价录取名额分配到校在本区招生计划

初中学校

招生学校
代码

招生学校名称 计划数

上海市嘉定区启良中学
上海市嘉定区方泰中学
...
招生学校代码
142001
142002
...
```

**问题**：
- 两段式结构导致数据分离
- 学校名称和计划数重复多次
- 难以用简单正则匹配

### 嘉定区高中学校代码

| 代码 | 名称 | 类型 |
|------|------|------|
| 142001 | 上海市嘉定区第一中学 | 区属 |
| 142002 | 上海交通大学附属中学嘉定分校 | 区属 |
| 142004 | 上海师范大学附属中学嘉定新城分校 | 区属 |
| 102056 | 上海交通大学附属中学 | 委属 |
| 102057 | 复旦大学附属中学 | 委属 |
| 042032 | 上海市上海中学 | 委属 |
| 152003 | 华东师范大学第二附属中学 | 委属 |
| 152006 | 上海师范大学附属中学 | 委属 |

### 已验证数据

- ✅ 交大附中附属嘉定洪德中学 - 真实存在（2025年新校）
- ✅ 交大附中附属嘉定德富中学 - 2024年已存在
- ✅ 上海师范大学附属中学嘉定新城分校 - 已在2025学校数据中

### 推荐处理方式

**使用 pdfplumber 直接提取表格数据**:

```python
import pdfplumber

with pdfplumber.open('2025_quota_to_school_jiading.pdf') as pdf:
    for page in pdf.pages:
        tables = page.extract_tables()
        for table in tables:
            for row_idx, row in enumerate(table):
                if row_idx < 2:  # 跳过表头
                    continue

                middle_name = str(row[0]).replace('\n', '').strip()

                # 解析4组数据
                for i in range(4):
                    base = 1 + i * 3
                    if base + 2 < len(row):
                        code = str(row[base]).replace('\n', '').strip() if row[base] else None
                        name = str(row[base+1]).replace('\n', '').strip() if row[base+1] else None
                        quota = str(row[base+2]).replace('\n', '').strip() if row[base+2] else None

                        if code and quota and quota.isdigit():
                            # 保存记录
                            pass
```

**已生成文件**:
- CSV: `processed/2025/quota_school/嘉定_2025_名额分配到校.csv`
- SQL: `db/seeds/053_seed_2025_jiading_quota_school.sql`
