{
  "permissions": {
    "allow": [
      "mcp__plugin_claude-mem_mcp-search__save_memory",
      "Bash(__NEW_LINE_e0b4e878324a942c__ echo \"=== New structure overview ===\")",
      "Bash(__NEW_LINE_88b5603015931104__ echo \"=== æœ€ç»ˆç›®å½•ç»“æ„å®Œæˆ ===\")",
      "Bash(wc:*)",
      "Bash(grep:*)",
      "Bash(python3:*)",
      "Bash(xargs:*)",
      "Bash(for:*)",
      "Bash(do basename:*)",
      "Bash(done)",
      "Bash(/Users/wangzhigang/workspace/wzgown/highschool/scripts/generate_middle_schools_sql.py << 'SCRIPTEND'\n#!/usr/bin/env python3\n\"\"\"\nä»åé¢åˆ†é…åˆ°æ ¡æ•°æ®ä¸­æå–åˆä¸­å­¦æ ¡åˆ—è¡¨\nç”Ÿæˆåˆä¸­å­¦æ ¡ seed SQL\n\"\"\"\n\nimport csv\nimport glob\nimport os\nfrom pathlib import Path\nfrom collections import defaultdict\n\n# åŒºå¿ä»£ç æ˜ å°„\nDISTRICT_CODE_MAP = {\n    'é»„æµ¦åŒº': 'HP',\n    'å¾æ±‡åŒº': 'XH',\n    'é•¿å®åŒº': 'CN',\n    'é™å®‰åŒº': 'JA',\n    'æ™®é™€åŒº': 'PT',\n    'è™¹å£åŒº': 'HK',\n    'æ¨æµ¦åŒº': 'YP',\n    'é—µè¡ŒåŒº': 'MH',\n    'å®å±±åŒº': 'BS',\n    'å˜‰å®šåŒº': 'JD',\n    'æµ¦ä¸œæ–°åŒº': 'PD',\n    'é‡‘å±±åŒº': 'JS',\n    'æ¾æ±ŸåŒº': 'SJ',\n    'é’æµ¦åŒº': 'QP',\n    'å¥‰è´¤åŒº': 'FX',\n    'å´‡æ˜åŒº': 'CM',\n}\n\n# ä»æ–‡ä»¶åæå–åŒºåçš„æ˜ å°„ï¼ˆå¤„ç†å¸¦æ‹¬å·çš„æ–‡ä»¶åï¼‰\nDISTRICT_FROM_FILENAME = {\n    'å˜‰å®šåŒº': \\('JD', 'å˜‰å®šåŒº'\\),\n    'å¥‰è´¤åŒº': \\('FX', 'å¥‰è´¤åŒº'\\),\n    'å®å±±åŒº': \\('BS', 'å®å±±åŒº'\\),\n    'æ™®é™€åŒº': \\('PT', 'æ™®é™€åŒº'\\),\n    'æ¾æ±ŸåŒº': \\('SJ', 'æ¾æ±ŸåŒº'\\),\n    'å¾æ±‡åŒº': \\('XH', 'å¾æ±‡åŒº'\\),\n    'æ¨æµ¦åŒº': \\('YP', 'æ¨æµ¦åŒº'\\),\n    'æµ¦ä¸œåŒº': \\('PD', 'æµ¦ä¸œæ–°åŒº', 'æµ¦ä¸œåŒº'\\),\n    'é—µè¡ŒåŒº': \\('MH', 'é—µè¡ŒåŒº'\\),\n    'é’æµ¦åŒº': \\('QP', 'é’æµ¦åŒº'\\),\n    'é™å®‰åŒº': \\('JA', 'é™å®‰åŒº'\\),\n    'é»„æµ¦åŒº': \\('HP', 'é»„æµ¦åŒº'\\),\n    'é‡‘å±±åŒº': \\('JS', 'é‡‘å±±åŒº'\\),\n    'å´‡æ˜åŒº': \\('CM', 'å´‡æ˜åŒº'\\),\n}\n\n# åŠåˆ«æ˜ å°„\nNATURE_CODE = 'PUBLIC'\n\n\ndef escape_sql\\(text\\):\n    \"\"\"è½¬ä¹‰SQLå­—ç¬¦ä¸²\"\"\"\n    if not text:\n        return ''\n    return text.replace\\(\"'\", \"''\"\\)\n\n\ndef detect_district_from_filename\\(filename\\):\n    \"\"\"ä»æ–‡ä»¶åæ£€æµ‹æ‰€å±åŒº - ä¼˜å…ˆåŒ¹é…æ›´é•¿çš„åŒºå\"\"\"\n    # æŒ‰é•¿åº¦é™åºæ’åˆ—ï¼Œä¼˜å…ˆåŒ¹é…æ›´å…·ä½“çš„åŒºå\n    district_patterns = [\n        \\('å˜‰å®šåŒº', 'JD'\\),\n        \\('å¥‰è´¤åŒº', 'FX'\\),\n        \\('å®å±±åŒº', 'BS'\\),\n        \\('æ™®é™€åŒº', 'PT'\\),\n        \\('æ¾æ±ŸåŒº', 'SJ'\\),\n        \\('å¾æ±‡åŒº', 'XH'\\),\n        \\('æ¨æµ¦åŒº', 'YP'\\),\n        \\('æµ¦ä¸œæ–°åŒº', 'PD'\\),\n        \\('æµ¦ä¸œåŒº', 'PD'\\),\n        \\('é—µè¡ŒåŒº', 'MH'\\),\n        \\('é’æµ¦åŒº', 'QP'\\),\n        \\('é™å®‰åŒº', 'JA'\\),\n        \\('é»„æµ¦åŒº', 'HP'\\),\n        \\('é‡‘å±±åŒº', 'JS'\\),\n        \\('å´‡æ˜åŒº', 'CM'\\),\n        \\('ä¸Šæµ·å¸‚', 'SH'\\),\n    ]\n    \n    for district_name, code in district_patterns:\n        if district_name in filename:\n            return code\n    \n    return None\n\n\ndef parse_jiading_format\\(file_path, district_code\\):\n    \"\"\"è§£æå˜‰å®šåŒºæ ¼å¼çš„æ–‡ä»¶\"\"\"\n    middle_schools = set\\(\\)\n\n    with open\\(file_path, 'r', encoding='utf-8'\\) as f:\n        reader = csv.DictReader\\(f\\)\n        for row in reader:\n            # ç¬¬ä¸€åˆ—\"åˆä¸­å­¦æ ¡\"çš„å€¼å°±æ˜¯å­¦æ ¡åç§°\n            middle_school_name = row.get\\('åˆä¸­å­¦æ ¡', ''\\).strip\\(\\)\n\n            # éªŒè¯å®ƒçœ‹èµ·æ¥åƒå­¦æ ¡åç§°ï¼ˆä¸æ˜¯ç©ºæˆ–\"åˆä¸­å­¦æ ¡\"åˆ—åï¼‰\n            if middle_school_name and middle_school_name not in ['', 'åˆä¸­å­¦æ ¡']:\n                # è¿›ä¸€æ­¥éªŒè¯ï¼šä¸å…¨æ˜¯æ•°å­—æˆ–é€—å·\n                if not middle_school_name.replace\\(',', ''\\).replace\\('.', ''\\).isdigit\\(\\):\n                    middle_schools.add\\(middle_school_name\\)\n\n    return middle_schools\n\n\ndef parse_fengxian_format\\(file_path, district_code\\):\n    \"\"\"è§£æå¥‰è´¤åŒº/é€šç”¨æ ¼å¼çš„æ–‡ä»¶\"\"\"\n    middle_schools = {}\n\n    with open\\(file_path, 'r', encoding='utf-8'\\) as f:\n        reader = csv.DictReader\\(f\\)\n        for row in reader:\n            # æŸ¥æ‰¾åˆä¸­å­¦æ ¡ä»£ç åˆ—\n            code = row.get\\('åˆä¸­å­¦æ ¡ä»£ç ', ''\\).strip\\(\\) or row.get\\('æ ¡ä»£ç ', ''\\).strip\\(\\)\n            name = row.get\\('åˆä¸­å­¦æ ¡åç§°', ''\\).strip\\(\\)\n\n            if code and name:\n                middle_schools[code] = {\n                    'name': name,\n                    'short_name': name[:6] if len\\(name\\) > 6 else name,\n                    'district_code': district_code,\n                }\n\n    return middle_schools\n\n\ndef scan_quota_school_files\\(\\):\n    \"\"\"æ‰«ææ‰€æœ‰åé¢åˆ†é…åˆ°æ ¡æ–‡ä»¶ï¼Œæå–åˆä¸­å­¦æ ¡\"\"\"\n    base_path = Path\\('/Users/wangzhigang/workspace/wzgown/highschool/original_data/raw/2024/quota_school'\\)\n\n    all_middle_schools = {}\n\n    # ä½¿ç”¨ glob è·å–æ‰€æœ‰ CSV æ–‡ä»¶\n    csv_files = list\\(base_path.glob\\('*.csv'\\)\\)\n\n    print\\(f\"ğŸ“‚ æ‰¾åˆ° {len\\(csv_files\\)} ä¸ªæ–‡ä»¶\"\\)\n\n    for file_path in sorted\\(csv_files\\):\n        filename = os.path.basename\\(file_path\\)\n        print\\(f\"ğŸ“– å¤„ç†: {filename}\"\\)\n\n        # æ£€æµ‹åŒºå\n        district_code = detect_district_from_filename\\(filename\\)\n\n        if not district_code:\n            print\\(f\"  âš ï¸  æ— æ³•è¯†åˆ«åŒºåï¼Œè·³è¿‡\"\\)\n            continue\n\n        # é€‰æ‹©è§£ææ–¹å¼\n        if district_code == 'JD':  # å˜‰å®šåŒºæ ¼å¼\n            schools = parse_jiading_format\\(file_path\\)\n            for name in schools:\n                code = f'JD{len\\(all_middle_schools\\)+1:04d}'\n                all_middle_schools[code] = {\n                    'name': name,\n                    'short_name': name[:6] if len\\(name\\) > 6 else name,\n                    'district_code': district_code,\n                    'district_name': 'å˜‰å®šåŒº',\n                }\n        elif district_code == 'FX':  # å¥‰è´¤åŒºæ ¼å¼\n            schools = parse_fengxian_format\\(file_path, district_code\\)\n            for code, info in schools.items\\(\\):\n                all_middle_schools[code] = info\n        else:\n            # å…¶ä»–åŒºä½¿ç”¨å˜‰å®šåŒºæ ¼å¼ï¼ˆé»˜è®¤ï¼‰\n            schools = parse_jiading_format\\(file_path\\)\n            for name in schools:\n                code = f'{district_code}{len\\(all_middle_schools\\)+1:04d}'\n                all_middle_schools[code] = {\n                    'name': name,\n                    'short_name': name[:6] if len\\(name\\) > 6 else name,\n                    'district_code': district_code,\n                    'district_name': DISTRICT_FROM_FILENAME.get\\(district_code, ['']\\)[0],\n                }\n\n    return all_middle_schools\n\n\ndef generate_middle_school_sql\\(\\):\n    \"\"\"ç”Ÿæˆåˆä¸­å­¦æ ¡ SQL\"\"\"\n    middle_schools = scan_quota_school_files\\(\\)\n\n    output_file = Path\\('/Users/wangzhigang/workspace/wzgown/highschool/db/seeds/040_seed_middle_schools_2024.sql'\\)\n\n    sql_lines = []\n    sql_lines.append\\(\"-- ============================================================================\"\\)\n    sql_lines.append\\(\"-- 2024å¹´åˆä¸­å­¦æ ¡åå• - ç§å­æ•°æ®ï¼ˆä»åé¢åˆ†é…åˆ°æ ¡æ•°æ®æå–ï¼‰\"\\)\n    sql_lines.append\\(\"-- æ•°æ®æ¥æº: raw/2024/quota_school/*.csvï¼ˆå…±12ä¸ªåŒºæ–‡ä»¶ï¼‰\"\\)\n    sql_lines.append\\(\"-- æ³¨ï¼šä¸é€‰æ‹©ç”Ÿæºåˆä¸­é»˜è®¤ä¸ºTRUEï¼Œé€‚ç”¨äºåé¢åˆ†é…åˆ°æ ¡å¡«æŠ¥èµ„æ ¼åˆ¤æ–­\"\\)\n    sql_lines.append\\(\"-- æ³¨ï¼šæ­¤æ•°æ®ä»…åŒ…å«æœ‰åé¢åˆ†é…åˆ°æ ¡çš„åˆä¸­å­¦æ ¡\"\\)\n    sql_lines.append\\(\"-- ============================================================================\"\\)\n    sql_lines.append\\(\"\"\\)\n\n    # æŒ‰åŒºå¿åˆ†ç»„\n    district_groups = defaultdict\\(list\\)\n    for code, info in middle_schools.items\\(\\):\n        district_groups[info['district_code']].append\\(\\(code, info\\)\\)\n\n    # æŒ‰åŒºå¿ä»£ç é¡ºåºç”Ÿæˆ\n    district_order = ['HP', 'XH', 'CN', 'JA', 'PT', 'HK', 'YP', 'MH', 'BS', 'JD', 'PD', 'JS', 'SJ', 'QP', 'FX', 'CM']\n\n    for district_code in district_order:\n        if district_code not in district_groups:\n            continue\n\n        schools = district_groups[district_code]\n        if not schools:\n            continue\n\n        # è·å–ä¸­æ–‡åç§°\n        district_cn = next\\(\\(k for k, v in DISTRICT_FROM_FILENAME.items\\(\\) if v == district_code\\), ''\\)\n\n        sql_lines.append\\(f\"-- {district_cn}\"\\)\n\n        for code, info in sorted\\(schools, key=lambda x: x[1]['name']\\):\n            school_name = escape_sql\\(info['name']\\)\n            short_name = school_name[:6] if len\\(school_name\\) > 6 else school_name\n\n            sql_lines.append\\(f\"-- {school_name}\"\\)\n            sql_lines.append\\(\"INSERT INTO ref_middle_school \\(code, name, short_name, district_id, school_nature_id, is_non_selective, data_year, is_active\\) VALUES\"\\)\n            sql_lines.append\\(f\"    '{code}', '{school_name}', '{short_name}',\"\\)\n            sql_lines.append\\(f\"    \\(SELECT id FROM ref_district WHERE code = '{district_code}'\\), '{NATURE_CODE}', TRUE, 2024, TRUE\\)\"\\)\n            sql_lines.append\\(\"ON CONFLICT \\(code, data_year\\) DO UPDATE SET\"\\)\n            sql_lines.append\\(\"    name = EXCLUDED.name,\"\\)\n            sql_lines.append\\(\"    short_name = EXCLUDED.short_name,\"\\)\n            sql_lines.append\\(\"    district_id = EXCLUDED.district_id,\"\\)\n            sql_lines.append\\(\"    updated_at = CURRENT_TIMESTAMP;\"\\)\n            sql_lines.append\\(\"\"\\)\n\n    # å†™å…¥æ–‡ä»¶\n    with open\\(output_file, 'w', encoding='utf-8'\\) as f:\n        f.write\\('\\\\n'.join\\(sql_lines\\)\\)\n\n    print\\(f\"âœ… å·²ç”Ÿæˆ: {output_file}\"\\)\n\n    # ç»Ÿè®¡è¾“å‡º\n    print\\(\"\\\\nğŸ“Š å„åŒºå­¦æ ¡ç»Ÿè®¡:\"\\)\n    district_counts = {}\n    for code, info in middle_schools.items\\(\\):\n        district_counts[info['district_code']] = district_counts.get\\(info['district_code'], 0\\) + 1\n\n    for district_code in district_order:\n        count = district_counts.get\\(district_code, 0\\)\n        if count > 0:\n            district_cn = next\\(\\(k for k, v in DISTRICT_CODE_MAP.items\\(\\) if v == district_code\\), ''\\)\n            print\\(f\"   {district_cn}: {count} æ‰€\"\\)\n\n\nif __name__ == '__main__':\n    generate_middle_school_sql\\(\\)\nSCRIPTEND)",
      "Bash(/Users/wangzhigang/workspace/wzgown/highschool/scripts/unify_middle_schools.py << 'EOF'\n#!/usr/bin/env python3\n\"\"\"ç»Ÿä¸€å¹¶æå–æ‰€æœ‰åŒºçš„åˆä¸­å­¦æ ¡æ•°æ®\"\"\"\n\nimport csv\nimport os\nfrom pathlib import Path\n\n# é…ç½®\nunified_dir = Path\\('/Users/wangzhigang/workspace/wzgown/highschool/original_data/processed/quota_school'\\)\n\n# åŒºåæ˜ å°„\nDISTRICTS = {\n    'HP': \\('é»„æµ¦åŒº', 'é»„æµ¦'\\),\n    'XH': \\('å¾æ±‡åŒº', 'å¾æ±‡'\\),\n    'CN': \\('é•¿å®åŒº', 'é•¿å®'\\),\n    'JA': \\('é™å®‰åŒº', 'é™å®‰'\\),\n    'PT': \\('æ™®é™€åŒº', 'æ™®é™€'\\),\n    'HK': \\('è™¹å£åŒº', 'è™¹å£'\\),\n    'YP': \\('æ¨æµ¦åŒº', 'æ¨æµ¦'\\),\n    'MH': \\('é—µè¡ŒåŒº', 'é—µè¡Œ'\\),\n    'BS': \\('å®å±±åŒº', 'å®å±±'\\),\n    'JD': \\('å˜‰å®šåŒº', 'å˜‰å®š'\\),\n    'PD': \\('æµ¦ä¸œæ–°åŒº', 'æµ¦ä¸œ'\\),\n    'JS': \\('é‡‘å±±åŒº', 'é‡‘å±±'\\),\n    'SJ': \\('æ¾æ±ŸåŒº', 'æ¾æ±Ÿ'\\),\n    'QP': \\('é’æµ¦åŒº', 'é’æµ¦'\\),\n    'FX': \\('å¥‰è´¤åŒº', 'å¥‰è´¤'\\),\n    'CM': \\('å´‡æ˜åŒº', 'å´‡æ˜'\\),\n}\n\ndef detect_district\\(filename\\):\n    for code, names in DISTRICTS.items\\(\\):\n        for name in names:\n            if name in filename:\n                return code\n    return None\n\ndef parse_standard\\(file_path\\):\n    \"\"\"è§£ææ ‡å‡†æ ¼å¼\"\"\"\n    schools = {}\n    with open\\(file_path, 'r', encoding='utf-8'\\) as f:\n        reader = csv.DictReader\\(f\\)\n        for row in reader:\n            code = row.get\\('å­¦æ ¡ç¼–å·', ''\\).strip\\(\\)\n            name = row.get\\('å­¦æ ¡åç§°', ''\\).strip\\(\\)\n            if code and name:\n                schools[code] = {\n                    'name': name,\n                    'short_name': name[:6] if len\\(name\\) > 6 else name,\n                    'district_code': 'STANDARD',\n                }\n\n    return schools\n\ndef parse_info_format\\(file_path\\):\n    \"\"\"è§£æä¿¡æ¯æ ¼å¼\"\"\"\n    schools = {}\n    with open\\(file_path, 'r', encoding='utf-8'\\) as f:\n        reader = csv.DictReader\\(f\\)\n        for row in reader:\n            if not row.get\\('åˆä¸­å­¦æ ¡åç§°'\\):\n                continue\n            code = row.get\\('åˆä¸­å­¦æ ¡ä»£ç ', ''\\).strip\\(\\)\n            name = row.get\\('åˆä¸­å­¦æ ¡åç§°', ''\\).strip\\(\\)\n            nature = 'PRIVATE' if 'æ°‘åŠ' in name else 'PUBLIC'\n            if code and name:\n                schools[code] = {\n                    'name': name,\n                    'short_name': name[:6] if len\\(name\\) > 6 else name,\n                    'district_code': 'INFO',\n                }\n\n    return schools\n\ndef parse_jiading_format\\(file_path\\):\n    \"\"\"è§£æå˜‰å®šæ ¼å¼\"\"\"\n    schools = set\\(\\)\n    with open\\(file_path, 'r', encoding='utf-8'\\) as f:\n        reader = csv.DictReader\\(f\\)\n        for row in reader:\n            name = row.get\\('åˆä¸­å­¦æ ¡', ''\\).strip\\(\\)\n            if name and name not in ['', 'åˆä¸­å­¦æ ¡']:\n                if not name.replace\\(',', ''\\).replace\\('.', ''\\).isdigit\\(\\):\n                    schools.add\\(name\\)\n\n    return schools\n\ndef process_files\\(\\):\n    \"\"\"å¤„ç†æ‰€æœ‰æ–‡ä»¶\"\"\"\n    all_schools = {}\n    base_path = Path\\('/Users/wangzhigang/workspace/wzgown/highschool/original_data/raw/2024/quota_school'\\)\n    csv_files = sorted\\(base_path.glob\\('*.csv'\\)\\)\n\n    for file_path in csv_files:\n        filename = os.path.basename\\(file_path\\)\n        district = detect\\(filename\\)\n\n        if not district:\n            print\\(f\"è·³è¿‡: {filename}\"\\)\n            continue\n\n        print\\(f\"å¤„ç†: {filename}\"\\)\n\n        if district == 'STANDARD':\n            schools = parse_standard\\(file_path\\)\n        elif district == 'INFO':\n            schools = parse_info_format\\(file_path\\)\n        else:\n            schools = parse_jiading_format\\(file_path\\)\n\n        for code, info in schools.items\\(\\):\n            all_schools[code] = info\n\n    return all_schools\n\n# å¤„ç†æ–‡ä»¶å¹¶ç”Ÿæˆ\nall_schools = process_files\\(\\)\n\noutput_file = unified_dir / 'middle_schools_2024_unified.csv'\n\nwith open\\(output_file, 'w', encoding='utf-8', newline=''\\) as f:\n    writer = csv.writer\\(f\\)\n    writer.writerow\\(['åºå·', 'å­¦æ ¡ä»£ç ', 'å­¦æ ¡åç§°', 'åŠåˆ«', 'æ‰€å±åŒº']\\)\n\n    rows = []\n    for code, info in sorted\\(all_schools.items\\(\\), key=lambda x: int\\(x[0]\\)\\):\n        rows.append\\([len\\(rows\\)+1, code, info['name'], info.get\\('nature', 'PUBLIC'\\), 'STANDARD']\\)\n\n    writer.writerows\\(rows\\)\n\nprint\\(f\"æ€»å­¦æ ¡æ•°: {len\\(all_schools\\)}\"\\)\nprint\\(f\"å·²ç”Ÿæˆ: {output_file}\"\\)\nEOF)",
      "Bash(ls:*)",
      "Bash(curl:*)",
      "Bash(pip3 install:*)",
      "Bash(/tmp/2023_exam_summary.txt << 'EOF'\n2023å¹´ä¸Šæµ·ä¸­è€ƒæ¦‚å†µæ•°æ®\n========================\n\næ•°æ®æ¥æº: ç”¨æˆ·æä¾›\n\nå­˜å‚¨ä½ç½®:\n  - db/seeds/005_seed_exam_summary_2023.sql\n\nä¸»è¦æ•°æ®:\n  1. è€ƒè¯•äººæ•°: çº¦11.9ä¸‡äºº\n  2. æ€»æ‹›ç”Ÿè®¡åˆ’: çº¦7.33ä¸‡äººï¼Œå½•å–ç‡66.6%\n  3. å¸‚é‡ç‚¹é«˜ä¸­æ‹›ç”Ÿ: çº¦2.61ä¸‡äººï¼Œå½•å–ç‡23.7%\n\nå½•å–æ§åˆ¶åˆ†æ•°çº¿:\n  - è‡ªä¸»æ‹›ç”Ÿ: 605åˆ†\n  - åé¢åˆ†é…åˆ°åŒº: 605åˆ†  \n  - å…¬åŠæ™®é€šé«˜ä¸­: 513åˆ†\n\nå­˜å‚¨è¡¨:\n  - ref_district_exam_count: å„åŒºä¸­è€ƒäººæ•°\n  - ref_control_score: æœ€ä½æŠ•æ¡£æ§åˆ¶åˆ†æ•°çº¿\nEOF)",
      "Bash(2025)",
      "Bash(âœ…)",
      "Bash(â³ å¾…å‘å¸ƒ)",
      "Bash(æ‹›ç”Ÿè®¡åˆ’ã€åé¢åˆ†é…å·²å®Œæˆ)",
      "Bash(2024)",
      "Bash(å®Œæ•´)",
      "Bash(===/g ' /Users/wangzhigang/workspace/wzgown/highschool/original_data/README.md)",
      "Bash(/tmp/data_summary.txt << 'EOF'\nğŸ“Š ä¸Šæµ·ä¸­è€ƒæ•°æ®æ”¶é›†å®Œæˆæ€»ç»“\n================================\n\n### 2025å¹´æ•°æ®\nâœ… åé¢åˆ†é…åˆ°åŒºæ‹›ç”Ÿè®¡åˆ’ï¼ˆ76æ‰€ï¼Œ6724åé¢ï¼‰\n  - PDFæ•°æ®å·²è§£æä¸ºCSV\n  - SQLç§å­æ–‡ä»¶å·²ç”Ÿæˆï¼š003_seed_quota_allocation_district_2025.sql\n  - æ•°æ®æ¥æºï¼šhttps://www.shmeea.edu.cn/download/20250528/014.pdf\n\n### 2024å¹´æ•°æ®ï¼ˆä¹‹å‰å·²æ”¶é›†ï¼‰\nâœ… å½•å–åˆ†æ•°çº¿ï¼ˆ1-15å¿—æ„¿ã€åé¢åˆ†é…åˆ°åŒº/åˆ°æ ¡ï¼‰\nâœ… åé¢åˆ†é…æ‹›ç”Ÿè®¡åˆ’ï¼ˆåˆ°åŒºã€åˆ°æ ¡ï¼‰\nâœ… å…¨å¸‚åˆä¸­å­¦æ ¡ï¼ˆ669æ‰€ï¼Œ16åŒºå®Œæ•´ï¼‰\n\n### 2023å¹´æ•°æ®ï¼ˆæ–°å¢ï¼‰\nâœ… ä¸­è€ƒæ€»ä½“æ¦‚å†µï¼ˆçº¦11.9ä¸‡äººï¼‰\n  - å½•å–æ§åˆ¶åˆ†æ•°çº¿å·²å®šä¹‰\n  - SQLç§å­æ–‡ä»¶å·²ç”Ÿæˆï¼š005_seed_exam_summary_2023.sql\n\n### 2024-2025å¹´ä¸­è€ƒæŠ¥åäººæ•°å¯¹æ¯”ï¼ˆæ–°å¢ï¼‰\nâœ… å®˜æ–¹æ•°æ®å¯¹æ¯”åˆ†æ\n  - 2024å¹´ï¼šçº¦11.8ä¸‡äººï¼ˆå¢åŠ 0.8ä¸‡ï¼‰\n  - 2025å¹´ï¼šçº¦12.7ä¸‡äººï¼ˆå¢åŠ 0.9ä¸‡ï¼‰\n  - å½•å–ç‡ï¼š2024å¹´64%ï¼Œ2025å¹´66%\n  - SQLç§å­æ–‡ä»¶å·²ç”Ÿæˆï¼š006_seed_exam_count_comparison_2024_2025.sql\n\n### ğŸ“ æ•°æ®è¦†ç›–èŒƒå›´\n- 2023å¹´ï¼šä¸­è€ƒæ¦‚å†µã€å½•å–åˆ†æ•°çº¿\n- 2024å¹´ï¼š16åŒºå®Œæ•´æ•°æ®ï¼ˆåˆä¸­ã€åˆ†æ•°çº¿ã€æ‹›ç”Ÿè®¡åˆ’ï¼‰\n- 2025å¹´ï¼šåé¢åˆ†é…åˆ°åŒºæ•°æ®\n\n### ğŸ—‚ï¸ å¤„ç†è„šæœ¬\n- scripts/parse_2025_quota_district_pdf.pyï¼šPDFè¡¨æ ¼è§£æ\n- scripts/generate_2025_quota_district_sql.pyï¼šSQLç”Ÿæˆ\nEOF)",
      "Bash(pdf_path = base_path / '| pdf_path = base_path / ''''policies\\\\'' '/g' /Users/wangzhigang/workspace/wzgown/highschool/scripts/etl_2025_quota_district.py)",
      "Bash(/Users/wangzhigang/workspace/wzgown/highschool/scripts/etl_2025_quota_district_clean.py << 'SCRIPT'\n#!/usr/bin/env python3\n\"\"\"\nETLæµç¨‹ï¼šä»PDFæå–2025å¹´åé¢åˆ†é…åˆ°åŒºæ•°æ®\n\"\"\"\n\nimport csv\nimport pdfplumber\nfrom pathlib import Path\n\nDISTRICT_MAP = {\n    'ä¸Šæµ·å¸‚': 'SH', 'é»„æµ¦åŒº': 'HP', 'å¾æ±‡åŒº': 'XH', 'é•¿å®åŒº': 'CN',\n    'é™å®‰åŒº': 'JA', 'æ™®é™€åŒº': 'PT', 'è™¹å£åŒº': 'HK', 'æ¨æµ¦åŒº': 'YP',\n    'é—µè¡ŒåŒº': 'MH', 'å®å±±åŒº': 'BS', 'å˜‰å®šåŒº': 'JD', 'æµ¦ä¸œæ–°åŒº': 'PD',\n    'é‡‘å±±åŒº': 'JS', 'æ¾æ±ŸåŒº': 'SJ', 'é’æµ¦åŒº': 'QP', 'å¥‰è´¤åŒº': 'FX', 'å´‡æ˜åŒº': 'CM',\n}\n\ndef clean_text\\(text\\):\n    if not text:\n        return ''\n    text = text.replace\\('\\\\n', ''\\)\n    unwanted_prefixes = ['ä¸', 'è®¸', 'å¯', 'è½¬', 'è½½', 'ç»', 'å¾—', 'æœª']\n    for prefix in unwanted_prefixes:\n        if text.startswith\\(prefix\\):\n            text = text[len\\(prefix\\):]\n            break\n    text = text.replace\\('ï¼Œ', ''\\).replace\\('ã€‚', ''\\)\n    return text.strip\\(\\)\n\ndef extract_pdf_to_csv\\(pdf_path, csv_output_path\\):\n    with pdfplumber.open\\(pdf_path\\) as pdf:\n        all_schools = []\n        for page_num, page in enumerate\\(pdf.pages\\):\n            tables = page.extract_tables\\(\\)\n            for table_num, table in enumerate\\(tables\\):\n                schools = parse_table\\(table\\)\n                if schools:\n                    print\\(f\"Page {page_num+1} Table {table_num+1}: {len\\(schools\\)} schools\"\\)\n                    all_schools.extend\\(schools\\)\n\n    unique_schools = {}\n    for school in all_schools:\n        key = f\"{school['code']}_{school['name']}\"\n        if key not in unique_schools:\n            unique_schools[key] = school\n\n    csv_output_path.mkdir\\(parents=True, exist_ok=True\\)\n    output_file = csv_output_path / '2025å¹´åé¢åˆ†é…åˆ°åŒºæ‹›ç”Ÿè®¡åˆ’.csv'\n\n    with open\\(output_file, 'w', encoding='utf-8', newline=''\\) as f:\n        writer = csv.writer\\(f\\)\n        writer.writerow\\(['åºå·', 'æ‹›ç”Ÿä»£ç ', 'å­¦æ ¡åç§°', 'æ‰€å±åŒº', 'åŒºä»£ç ', 'è®¡åˆ’æ•°']\\)\n        for school in unique_schools.values\\(\\):\n            writer.writerow\\([school['seq_no'], school['code'], school['name'],\n                          school['district'], school['district_code'], school['plan_count']]\\)\n\n    print\\(f\"Extracted {len\\(unique_schools\\)} schools to {output_file}\"\\)\n    return len\\(unique_schools\\)\n\ndef parse_table\\(table\\):\n    schools = []\n    for row_idx, row in enumerate\\(table[1:], start=1\\):\n        if len\\(row\\) < 9:\n            continue\n        cells = [clean_text\\(str\\(cell\\)\\) if cell else '' for cell in row]\n        seq_no = cells[0]\n        code = cells[1]\n        name = cells[2]\n        district = cells[3]\n        plan_count = 0\n        for i in range\\(8, len\\(cells\\)\\):\n            cell_text = cells[i]\n            if cell_text and cell_text.isdigit\\(\\):\n                plan_count = int\\(cell_text\\)\n                break\n        if not code or not name or not district:\n            continue\n        if code and code.isdigit\\(\\):\n            schools.append\\({'seq_no': seq_no, 'code': code, 'name': name,\n                          'district': district, 'district_code': DISTRICT_MAP.get\\(district, 'SH'\\),\n                          'plan_count': plan_count}\\)\n    return schools\n\ndef main\\(\\):\n    base_path = Path\\('/Users/wangzhigang/workspace/wzgown/highschool/original_data/raw/2025'\\)\n    pdf_path = base_path / 'policies/2025å¹´åé¢åˆ†é…åˆ°åŒºæ‹›ç”Ÿè®¡åˆ’.pdf'\n    csv_output_path = Path\\('/Users/wangzhigang/workspace/wzgown/highschool/original_data/processed/2025/quota_district'\\)\n\n    print\\(\"ETL Pipeline: 2025 Quota Allocation District\"\\)\n    school_count = extract_pdf_to_csv\\(pdf_path, csv_output_path\\)\n    print\\(f\"Total: {school_count} schools extracted\"\\)\nSCRIPT)",
      "Bash(/Users/wangzhigang/workspace/wzgown/highschool/scripts/etl_2025_quota_district_v2.py << 'SCRIPT'\n#!/usr/bin/env python3\n\"\"\"ETLæµç¨‹ï¼šä»PDFæå–2025å¹´åé¢åˆ†é…åˆ°åŒºæ•°æ®\"\"\"\n\nimport csv\nimport pdfplumber\nfrom pathlib import Path\n\nDISTRICT_MAP = {\n    'ä¸Šæµ·å¸‚': 'SH', 'é»„æµ¦åŒº': 'HP', 'å¾æ±‡åŒº': 'XH', 'é•¿å®åŒº': 'CN',\n    'é™å®‰åŒº': 'JA', 'æ™®é™€åŒº': 'PT', 'è™¹å£åŒº': 'HK', 'æ¨æµ¦åŒº': 'YP',\n    'é—µè¡ŒåŒº': 'MH', 'å®å±±åŒº': 'BS', 'å˜‰å®šåŒº': 'JD', 'æµ¦ä¸œæ–°åŒº': 'PD',\n    'é‡‘å±±åŒº': 'JS', 'æ¾æ±ŸåŒº': 'SJ', 'é’æµ¦åŒº': 'QP', 'å¥‰è´¤åŒº': 'FX', 'å´‡æ˜åŒº': 'CM',\n}\n\ndef clean_text\\(text\\):\n    if not text:\n        return ''\n    text = text.replace\\('\\\\n', ''\\)\n    unwanted_prefixes = ['ä¸', 'è®¸', 'å¯', 'è½¬', 'è½½', 'ç»', 'å¾—', 'æœª']\n    for prefix in unwanted_prefixes:\n        if text.startswith\\(prefix\\):\n            text = text[len\\(prefix\\):]\n            break\n    text = text.replace\\('ï¼Œ', ''\\).replace\\('ã€‚', ''\\)\n    return text.strip\\(\\)\n\ndef extract_pdf_to_csv\\(pdf_path, csv_output_path\\):\n    with pdfplumber.open\\(pdf_path\\) as pdf:\n        all_schools = []\n        for page_num, page in enumerate\\(pdf.pages\\):\n            tables = page.extract_tables\\(\\)\n            for table_num, table in enumerate\\(tables\\):\n                schools = parse_table\\(table\\)\n                print\\(f\"Page {page_num+1} Table {table_num+1}: {len\\(schools\\)} schools\"\\)\n                if schools:\n                    all_schools.extend\\(schools\\)\n\n    unique_schools = {}\n    for school in all_schools:\n        key = f\"{school['code']}_{school['name']}\"\n        if key not in unique_schools:\n            unique_schools[key] = school\n\n    csv_output_path.mkdir\\(parents=True, exist_ok=True\\)\n    output_file = csv_output_path / '2025å¹´åé¢åˆ†é…åˆ°åŒºæ‹›ç”Ÿè®¡åˆ’.csv'\n\n    with open\\(output_file, 'w', encoding='utf-8', newline=''\\) as f:\n        writer = csv.writer\\(f\\)\n        writer.writerow\\(['åºå·', 'æ‹›ç”Ÿä»£ç ', 'å­¦æ ¡åç§°', 'æ‰€å±åŒº', 'åŒºä»£ç ', 'è®¡åˆ’æ•°']\\)\n        for school in unique_schools.values\\(\\):\n            writer.writerow\\([school['seq_no'], school['code'], school['name'],\n                          school['district'], school['district_code'], school['plan_count']]\\)\n\n    print\\(f\"Extracted {len\\(unique_schools\\)} schools to {output_file}\"\\)\n    return len\\(unique_schools\\)\n\ndef parse_table\\(table\\):\n    schools = []\n    for row_idx, row in enumerate\\(table[1:], start=1\\):\n        if len\\(row\\) < 9:\n            continue\n        cells = [clean_text\\(str\\(cell\\)\\) if cell else '' for cell in row]\n        seq_no = cells[0]\n        code = cells[1]\n        name = cells[2]\n        district = cells[3]\n        plan_count = 0\n        for i in range\\(8, len\\(cells\\)\\):\n            cell_text = cells[i]\n            if cell_text and cell_text.isdigit\\(\\):\n                plan_count = int\\(cell_text\\)\n                break\n        if not code or not name or not district:\n            continue\n        if code and code.isdigit\\(\\):\n            schools.append\\({'seq_no': seq_no, 'code': code, 'name': name,\n                          'district': district, 'district_code': DISTRICT_MAP.get\\(district, 'SH'\\),\n                          'plan_count': plan_count}\\)\n    return schools\n\ndef main\\(\\):\n    pdf_path = Path\\('/Users/wangzhigang/workspace/wzgown/highschool/original_data/policies/2025å¹´åé¢åˆ†é…åˆ°åŒºæ‹›ç”Ÿè®¡åˆ’.pdf'\\)\n    csv_output_path = Path\\('/Users/wangzhigang/workspace/wzgown/highschool/original_data/processed/2025/quota_district'\\)\n\n    print\\(\"ETL Pipeline: 2025 Quota Allocation District\"\\)\n    school_count = extract_pdf_to_csv\\(pdf_path, csv_output_path\\)\n    print\\(f\"Total: {school_count} schools extracted\"\\)\nSCRIPT)",
      "Bash(pdf_path = base_path / '| raw/2025/quota_district\\\\'' '/g' /Users/wangzhigang/workspace/wzgown/highschool/scripts/etl_2025_quota_district_v2.py)",
      "Bash(æ‹›ç”Ÿè®¡åˆ’)",
      "Bash(åˆ†æ•°çº¿)",
      "Bash(åé¢åˆ†é…)",
      "Bash(å„åŒºäººæ•°)",
      "Bash(å­¦æ ¡æ•°æ®)",
      "Bash(çŠ¶æ€)",
      "Bash(' /Users/wangzhigang/workspace/wzgown/highschool/original_data/README.md)",
      "Bash(find:*)",
      "Bash(pdfplumber:*)",
      "WebSearch",
      "Bash(python:*)",
      "Bash(chmod:*)",
      "Bash(makeitdown:*)",
      "Bash(go install:*)",
      "Bash(docker run:*)",
      "Bash(echo:*)",
      "Bash(zip:*)",
      "Bash(unzip:*)",
      "Bash(sort:*)",
      "Bash(test:*)",
      "Bash(docker exec:*)",
      "Bash(docker ps:*)",
      "Bash(docker port:*)",
      "Bash(psql:*)",
      "Bash(pgrep:*)",
      "Bash(lsof:*)",
      "Bash(claude mcp add:*)",
      "Bash(pkill:*)",
      "Bash(npm install:*)",
      "Bash(npm run type-check:*)",
      "mcp__chrome-devtools__list_pages",
      "mcp__chrome-devtools__navigate_page",
      "mcp__chrome-devtools__take_snapshot",
      "mcp__chrome-devtools__click",
      "mcp__chrome-devtools__fill",
      "mcp__chrome-devtools__press_key",
      "mcp__chrome-devtools__list_console_messages",
      "mcp__chrome-devtools__evaluate_script",
      "mcp__chrome-devtools__take_screenshot",
      "mcp__chrome-devtools__drag",
      "Bash(PGPASSWORD=highschool psql:*)",
      "Bash(docker compose:*)",
      "Bash(PGPASSWORD='HS2025!db#SecurePass88' psql:*)"
    ]
  }
}
