# ref_school 表数据修正报告

## 概要

**修正日期**: 2026-02-22
**数据来源**: `original_data/raw/2025/2025 年上海市高中招生学校名单.pdf`（权威来源）
**修正结果**: ✅ **完全一致** - 数据库活跃学校与PDF完全一致

## 修正统计

| 指标 | 修正前 | 修正后 |
|------|--------|--------|
| 总记录数 | 293 | 297 |
| 活跃学校数 | 293 | 296 |
| 不活跃学校数 | 0 | 1 |

## 修正详情

### 1. 代码修正（3所学校）

这些学校的招生代码在数据库与PDF中不一致，已按照PDF权威来源修正：

| 学校名称 | 原代码 | 新代码 | 所在区 |
|----------|--------|--------|--------|
| 上海市嘉定区嘉一实验高级中学 | 144011 | 142003 | 嘉定区 |
| 上海大学附属嘉定高级中学 | 143004 | 144011 | 嘉定区 |
| 上海宋庆龄学校 | 185000 | 185008 | 青浦区 |

### 2. 新增学校（4所）

这些学校在PDF中存在但数据库中缺失，已新增：

| 代码 | 学校名称 | 所在区 | 学校类型 |
|------|----------|--------|----------|
| 094004 | 上海市友谊中学 | 虹口区 | 一般高中 |
| 143002 | 上海师范大学附属嘉定高级中学 | 嘉定区 | 区实验性示范性高中 |
| 143003 | 上海市嘉定区安亭高级中学 | 嘉定区 | 区实验性示范性高中 |
| 163000 | 上海市张堰中学 | 金山区 | 区实验性示范性高中 |

### 3. 标记不活跃（1所学校）

该学校在PDF中未找到，已标记为不活跃：

| 代码 | 学校名称 | 所在区 | 状态 |
|------|----------|--------|------|
| 012013 | 上海市五爱高级中学 | 黄浦区 | 不活跃 |

**注意**: 该学校有外键引用（11条历史分数记录，1条招生计划记录），因此标记为不活跃而非删除，以保持数据完整性。

## 验证结果

### 代码一致性验证

```
PDF代码总数: 296
数据库活跃代码总数: 296

仅在数据库中的代码: 0
仅在PDF中的代码: 0

✅ 数据库活跃学校与PDF完全一致
```

### 区县分布验证

| 区县 | 活跃学校数 |
|------|------------|
| 浦东新区 | 68 |
| 闵行区 | 29 |
| 宝山区 | 18 |
| 嘉定区 | 12 |
| 松江区 | 17 |
| 徐汇区 | 16 |
| 静安区 | 16 |
| 普陀区 | 12 |
| 杨浦区 | 14 |
| 虹口区 | 10 |
| 长宁区 | 7 |
| 黄浦区 | 9 |
| 青浦区 | 10 |
| 奉贤区 | 9 |
| 金山区 | 10 |
| 崇明区 | 8 |
| 上海市（市属） | 8 |
| **总计** | **296** |

## 执行的SQL脚本

1. 主修正脚本: `db/patches/patch_fix_school_data_2025_from_pdf.sql`
2. 补充修正（通过psql执行）:
   - 重新激活误标记的学校（籽奥高级中学、博华高级中学）
   - 新增遗漏的学校（上海市张堰中学）

## 数据完整性保障

- ✅ 所有修改在事务中执行，失败自动回滚
- ✅ 修改前已备份原始数据到临时表
- ✅ 外键引用的学校标记为不活跃而非删除
- ✅ 所有代码变更保持唯一约束（code + data_year）

## 备注

1. **PDF提取说明**: PDF文件包含背景水印文字，导致直接提取文本时出现字符干扰（如"院"、"育"、"考"等）。通过正则表达式清理后成功提取了所有296个学校代码。

2. **代码变更原因**: 部分学校的招生代码在2025年有所调整，以PDF官方名单为准进行了更新。

3. **五爱高级中学**: 该学校未在2025年招生名单中出现，可能已停止招生或合并。已标记为不活跃，如有需要可进一步核实。

---

*报告生成时间: 2026-02-22*
*数据验证: ✅ 完全一致*
